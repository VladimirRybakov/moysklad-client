/**
 * clone
 * Date: 15.06.14
 * Vitaliy V. Makeev (w.makeev@gmail.com)
 */

var _ = require('lodash');

var fieldsToReset = [
    'createdBy',
    'updated',
    'updatedBy',
    'uuid',
    'operationUuid'
];

var resetUuids = function (obj) {

    if (obj) {
        //TODO Может быть использовать _.omit, вместо обнуления полей?
        _.forEach(fieldsToReset, function (fieldName) {
            if (obj[fieldName]) obj[fieldName] = null;
        });

        for (var property in obj) {
            if (obj.hasOwnProperty(property) && typeof obj[property] === 'object') {
                resetUuids(obj[property]);
            }
        }
    }

    return obj;
};

/**
 * Клонирует объекты МойСклад
 * - используется стандартная процедура глубокого клонирования,
 * за тем исключением, что обнуляются идентификаторы объектов "uuid"
 *
 * @param obj Клонируемый объект
 */
var clone = function (obj) {

    if (obj) {
        //TODO Реализовать свой механизм клонирования (приходится два раза обходить гарф объекта)
        var cloned = _.cloneDeep(obj);

        return resetUuids(cloned);
    }

    return null;
};

module.exports = clone;