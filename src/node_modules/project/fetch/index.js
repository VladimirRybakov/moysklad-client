/**
 * Default Http request provider factory
 * Date: 11.01.14
 * Vitaliy V. Makeev (w.makeev@gmail.com)
 */

var _               = require('lodash')
  , Fiber           = require('common-node/node_modules/fibers')
  , callbackAdapter = require('./../../../tools/callbackAdapter');

var fetch = {

    fetch: function (options, callback) {

        if (Fiber.current) {
            console.log('common-node fetch');
            var result;
            require('./common-node').fetch(options, function (err, result) {
                result = callbackAdapter(err, result, callback);
            });
            return result;

        } else {
            console.log('node fetch');
            if (!callback) throw new Error('fetch: callback must be defined in async mode');
            require('./node').fetch(options, callback);
        }
    }
};

module.exports = fetch;